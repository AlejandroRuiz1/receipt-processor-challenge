# Receipt Processor Challenge

## Tech Stack

For this challenge I used `JavaScript`, `Node.js` and `Express` to develop the requested back end functionality. 

I also used `Jest` and `Supertest` for testing purposes.

## Running this project 

### Using Docker:

To run this project you must have `Docker` configured in your system. 

1) Run the Docker engine.
2) Navigate to the project's root directory using `cd`.
3) Build the docker image using the following command in your terminal:

```bash
# Build docker image
docker build . -t receipt-processor
```

4) Run the docker image using the following command in your terminal:
```bash
# Run docker image
docker run -p 8000:8000 receipt-processor

# PORT (8000) can be whichever you want as long as there are no other services using that port.
```


You should now see the following in your terminal:
```c
$ docker build . -t receipt-processor
[+] Building 5.7s (11/11) FINISHED                                                                           docker:default 
 => [internal] load .dockerignore                                      0.0s 
 => => transferring context: 67B                                       0.0s 
 => [internal] load build definition from Dockerfile                   0.0s 
 => => transferring dockerfile: 341B                                   0.0s 
 => [internal] load metadata for docker.io/library/node:18             0.7s 
 => [auth] library/node:pull token for registry-1.docker.io            0.0s 
 => [internal] load build context                                      0.1s 
 => => transferring context: 278.51kB                                  0.1s 
 => [1/5] FROM docker.io/library/node:18@sha256:ee0a21d64211d92d4340b225c556e9ef1a8bce1d5b03b49f5f07bf1dbbaa5626    0.0s 
 => CACHED [2/5] WORKDIR /usr/src/app                                  0.0s
 => [3/5] COPY package*.json ./                                        0.1s
 => [4/5] RUN npm install                                              3.8s
 => [5/5] COPY . .                                                     0.1s
 => exporting to image                                                 0.8s
 => => exporting layers                                                0.8s
 => => writing image sha256:168b62a23fc2f9bdb56ccc5a2d7aac9a3247362cc3e06acd923a8dac524c6827    0.0s
 => => naming to docker.io/library/receipt-processor-test              0.0s
```
Now the docker image is ready and the receipt-processor can be tested.

## Interfacing with the receipt-processor API:

### Endpoint: Process Receipts

* Path: `/receipts/process`
* Method: `POST`
* Payload: Receipt JSON
* Response: JSON containing an id for the receipt.

#### Description:

Takes in a JSON receipt and returns a JSON object with an ID generated by your code.

Example JSON receipt:

```bash
{
  "retailer": "Walgreens",
  "purchaseDate": "2022-01-02",
  "purchaseTime": "08:13",
  "total": "2.65",
  "items": [
    { "shortDescription": "Pepsi - 12-oz", "price": "1.25" },
    { "shortDescription": "Dasani", "price": "1.40" }
  ]
}
```

### Making an API call:

To make a call to this endpoint you can use curl, or your tool of preference such as Postman or Insomnia. 

#### Using curl:
Specify POST HTTP-Method by using `-X POST` and send the receipt as payload using `-d` followed by the json receipt in the following format: `'{"example":"data", ...}'`.

```bash
curl -X POST -H "Content-Type: application/json" localhost:8000/receipts/process -d '{"retailer": "Walgreens",  "purchaseDate": "2022-01-02",  "purchaseTime": "08:13",  "total": "2.65",  "items": [ { "shortDescription": "Pepsi - 12-oz", "price": "1.25" },{ "shortDescription": "Dasani", "price": "1.40" }]}'
```

After successfully querying the endpoint we receive:

```json
{"id":"fb5f6007-eab1-4fb5-9278-3a52664db8f2"}
```

This `id` can be passed into the next endpoint: `/receipts/{id}/points` to get the number of points the receipt was awarded.

---

### Endpoint: Get Points


* Path: `/receipts/{id}/points`
* Method: `GET`
* Response: A JSON object containing the number of points awarded.

#### Description
A simple Getter endpoint that looks up a receipt by its ID and returns an object specifying the points awarded.

### Making an API call:

To make a call to this endpoint you can use curl, or your tool of preference such as Postman or Insomnia. 

#### Using the `result` from the previous `POST` request:

```json
{"id":"fb5f6007-eab1-4fb5-9278-3a52664db8f2"}
```
#### Use the following curl command to make a `GET` request, the `id` parameter is required:

```bash
curl localhost:8000/receipts/fb5f6007-eab1-4fb5-9278-3a52664db8f2/points 
```
#### After successfully querying the endpoint it returns the points pertaining to the specified receipt:

```json
{"points":15}
```
---

### Additional Endpoint: Get all receipts


* Path: `/receipts/`
* Method: `GET`
* Response: A JSON object containing all receipts stored in memory.

#### Description
A simple Getter endpoint that returns an object containing all receipts.

### Making an API call:

To make a call to this endpoint you can use curl, or your tool of preference such as Postman or Insomnia. 

#### Use the following curl command to make a `GET` request:

```bash
curl localhost:8000/receipts
```
#### After successfully querying the endpoint it returns all receipts stored in memory:

```json
{ 
  "receipts": {
    "d32fdd52-6c65-4c0c-a9a0-4a1ebe8fa2bc": {
        "retailer":"Walgreens",
        "purchaseDate":"2022-01-02",
        "purchaseTime":"08:13",
        "total":"2.65",
        "items":[
          {"shortDescription":"Pepsi - 12-oz","price":"1.25"},
          {"shortDescription":"Dasani","price":"1.40"}
        ],
        "points":15
    }
  }
}
```

## Testing endpoints using Jest

To test the endpoints using Jest open a terminal and navigate to the root project folder using `cd`:
```bash
cd receipt-processor-challenge/
```
In the root folder:
```bash
ls

api.yml  challengeInstructions.md  controllers/  Dockerfile  examples/  functions/  index.js  node_modules/  package.json  package-lock.json  README.md  routes/  server.js  tests/
```
Run the following command:
```bash
npm test
```
This command runs all tests and returns a summary of test results:
```js
> receipt-processor-challenge@1.0.0 test
> jest

 PASS  tests/api.test.js
  Target:
    Process Receipt                                                                                                                                                                                                                                
      √ testEmptyRequestBody (28 ms)                                                                                                                                                                                                               
      √ testProcessReceipt (18 ms)                                                                                                                                                                                                                 
    Get Points                                                                                                                                                                                                                                     
      √ testGetPoints (4 ms)                                                                                                                                                                                                                       
      √ testGetPointsIdNotFound (3 ms)                                                                                                                                                                                                             
  M&M Corner Market:                                                                                                                                                                                                                               
    Process Receipt                                                                                                                                                                                                                                
      √ testEmptyRequestBody (3 ms)                                                                                                                                                                                                                
      √ testProcessReceipt (4 ms)                                                                                                                                                                                                                  
    Get Points                                                                                                                                                                                                                                     
      √ testGetPoints (3 ms)                                                                                                                                                                                                                       
      √ testGetPointsIdNotFound (3 ms)                                                                                                                                                                                                             
  Walgreens:                                                                                                                                                                                                                                       
    Process Receipt                                                                                                                                                                                                                                
      √ testEmptyRequestBody (4 ms)                                                                                                                                                                                                                
      √ testProcessReceipt (3 ms)                                                                                                                                                                                                                  
    Get Points                                                                                                                                                                                                                                     
      √ testGetPoints (3 ms)                                                                                                                                                                                                                       
      √ testGetPointsIdNotFound (3 ms)                                                                                                                                                                                                             
  7-Eleven:                                                                                                                                                                                                                                        
    Process Receipt                                                                                                                                                                                                                                
      √ testEmptyRequestBody (3 ms)                                                                                                                                                                                                                
      √ testProcessReceipt (3 ms)                                                                                                                                                                                                                  
    Get Points
      √ testGetPoints (3 ms)
      √ testGetPointsIdNotFound (3 ms)

Test Suites: 1 passed, 1 total
Tests:       16 passed, 16 total
Snapshots:   0 total
Time:        0.892 s, estimated 2 s
Ran all test suites.
```


## Stopping docker container

### Step 1: `docker ps`
```bash
# List running containers
docker ps

CONTAINER ID   IMAGE                    COMMAND                  CREATED       STATUS       PORTS                    NAMES
554299b1eda3   receipt-processor   "docker-entrypoint.s…"   3 minutes ago   Up 3 minutes   0.0.0.0:8000->8000/tcp   stoic_euler
```
### Step 2: `docker stop containerid`
```bash
# Stop container with specified id. Id is returned on success.
docker stop 554299b1eda3
554299b1eda3
```
### Optional steps:
### Step 3: `docker ps` (If you really want to make sure it has been stopped)
```bash
# List containers -> No runnning containers
docker ps

CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```
### Step 4: `docker rm containerid`

```bash
# If you want to remove container from your containers. Id is returned on success.
docker rm 554299b1eda3
554299b1eda3
```

## Note

Receipt data is stored in memory therefore data does not persist when application container is stopped.

---
### `Thank you for taking the time to evaluate my code! :)`
---
